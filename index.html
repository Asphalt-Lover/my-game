<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CBONDS: –ü–æ–ª—ë—Ç –∫ –¶–µ–Ω—Ç—Ä—É –ì–∞–ª–∞–∫—Ç–∏–∫–∏</title>
  <meta name="theme-color" content="#0b0f1a" />
  <style>
    :root{
      --bg:#0b0f1a;
      --panel:rgba(14, 22, 44, .65);
      --panel2:rgba(10, 16, 34, .55);
      --line:rgba(130, 170, 255, .18);
      --text:#dfe9ff;
      --muted:rgba(223,233,255,.72);
      --cyan:#7cf7ff;
      --violet:#b8a7ff;
      --amber:#ffd08a;
      --danger:#ff6b7a;
      --ok:#86ffb0;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background: radial-gradient(1200px 700px at 70% -10%, rgba(124,247,255,.14), transparent 55%),
                  radial-gradient(900px 600px at 10% 10%, rgba(184,167,255,.14), transparent 55%),
                  radial-gradient(900px 600px at 70% 90%, rgba(255,208,138,.10), transparent 55%),
                  linear-gradient(180deg, #070a12, var(--bg));
      overflow-x:hidden;
    }

    /* starfield */
    .starfield, .starfield:before, .starfield:after{
      position:fixed; inset:0;
      background-repeat:repeat;
      pointer-events:none;
      content:"";
      z-index:-2;
      opacity:.65;
    }
    .starfield{
      background-image:
        radial-gradient(1px 1px at 10px 20px, rgba(255,255,255,.55), transparent 60%),
        radial-gradient(1px 1px at 50px 80px, rgba(255,255,255,.45), transparent 60%),
        radial-gradient(1px 1px at 90px 140px, rgba(255,255,255,.35), transparent 60%),
        radial-gradient(1px 1px at 140px 30px, rgba(255,255,255,.40), transparent 60%),
        radial-gradient(1px 1px at 200px 110px, rgba(255,255,255,.35), transparent 60%);
      background-size: 220px 160px;
      filter: drop-shadow(0 0 8px rgba(124,247,255,.08));
    }
    .starfield:before{
      background-image:
        radial-gradient(1px 1px at 30px 60px, rgba(255,255,255,.35), transparent 60%),
        radial-gradient(1px 1px at 120px 90px, rgba(255,255,255,.30), transparent 60%),
        radial-gradient(1px 1px at 180px 20px, rgba(255,255,255,.25), transparent 60%);
      background-size: 260px 190px;
      animation: drift 18s linear infinite;
      opacity:.55;
      z-index:-3;
    }
    .starfield:after{
      background-image:
        radial-gradient(1px 1px at 40px 120px, rgba(255,255,255,.28), transparent 60%),
        radial-gradient(1px 1px at 160px 60px, rgba(255,255,255,.24), transparent 60%),
        radial-gradient(1px 1px at 210px 140px, rgba(255,255,255,.20), transparent 60%);
      background-size: 300px 220px;
      animation: drift 28s linear infinite reverse;
      opacity:.45;
      z-index:-4;
    }
    @keyframes drift{
      from{ transform: translate3d(0,0,0) }
      to{ transform: translate3d(-120px, 80px, 0) }
    }

    /* subtle scanlines */
    .scanlines{
      position:fixed; inset:0;
      background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,.03),
        rgba(255,255,255,.03) 1px,
        transparent 2px,
        transparent 5px
      );
      mix-blend-mode: overlay;
      opacity:.22;
      pointer-events:none;
      z-index:-1;
    }

    .wrap{
      max-width:1050px;
      margin: 24px auto 56px;
      padding: 0 16px;
    }

    header{
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      margin-bottom:18px;
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .title{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .sigil{
      width:38px; height:38px;
      border-radius:12px;
      background:
        radial-gradient(circle at 30% 30%, rgba(124,247,255,.85), rgba(124,247,255,.15) 45%, transparent 70%),
        radial-gradient(circle at 70% 70%, rgba(184,167,255,.65), transparent 60%),
        linear-gradient(135deg, rgba(124,247,255,.22), rgba(184,167,255,.22));
      border:1px solid rgba(124,247,255,.25);
      box-shadow: 0 0 40px rgba(124,247,255,.10);
      position:relative;
      overflow:hidden;
    }
    .sigil:after{
      content:"";
      position:absolute; inset:-40%;
      background: conic-gradient(from 0deg, transparent, rgba(255,255,255,.10), transparent 30%, rgba(124,247,255,.10), transparent 60%);
      animation: spin 10s linear infinite;
      opacity:.8;
    }
    @keyframes spin{ to{ transform:rotate(360deg) } }

    h1{
      margin:0;
      font-size: 18px;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-family: var(--mono);
      color: rgba(223,233,255,.95);
    }
    .subtitle{
      margin:0;
      font-size: 13px;
      color: var(--muted);
      max-width: 760px;
      line-height:1.4;
    }

    .topActions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .btn{
      appearance:none;
      border:1px solid rgba(124,247,255,.18);
      background: linear-gradient(180deg, rgba(124,247,255,.10), rgba(124,247,255,.02));
      color: var(--text);
      border-radius: 14px;
      padding: 10px 12px;
      cursor:pointer;
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing:.04em;
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
      transition: transform .08s ease, border-color .18s ease, box-shadow .18s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(124,247,255,.33); }
    .btn:active{ transform: translateY(0); }
    .btn.secondary{
      border-color: rgba(184,167,255,.18);
      background: linear-gradient(180deg, rgba(184,167,255,.10), rgba(184,167,255,.02));
    }
    .btn.danger{
      border-color: rgba(255,107,122,.25);
      background: linear-gradient(180deg, rgba(255,107,122,.12), rgba(255,107,122,.02));
    }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 920px){
      .grid{ grid-template-columns: 1fr; }
      .topActions{ justify-content:flex-start; }
    }

    .card{
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--panel), rgba(10,16,34,.40));
      border: 1px solid rgba(130,170,255,.14);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .card:before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(600px 220px at 20% 0%, rgba(124,247,255,.14), transparent 60%),
        radial-gradient(420px 180px at 85% 20%, rgba(184,167,255,.12), transparent 60%),
        radial-gradient(420px 200px at 60% 105%, rgba(255,208,138,.08), transparent 60%);
      opacity:.85;
      pointer-events:none;
    }

    .cardInner{ position:relative; padding: 14px 14px 14px; }

    .hud{
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .hudRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .hudLabel{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(223,233,255,.85);
      letter-spacing:.04em;
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .badge{
      font-family: var(--mono);
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border:1px solid rgba(130,170,255,.16);
      background: rgba(10,16,34,.40);
      color: rgba(223,233,255,.9);
    }

    .bar{
      height: 10px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(130,170,255,.14);
      overflow:hidden;
      flex:1;
      position:relative;
    }
    .bar > i{
      display:block;
      height:100%;
      width: 0%;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(124,247,255,.75), rgba(184,167,255,.75));
      box-shadow: 0 0 18px rgba(124,247,255,.20);
      transition: width .35s ease;
    }
    .bar.danger > i{
      background: linear-gradient(90deg, rgba(255,208,138,.70), rgba(255,107,122,.75));
      box-shadow: 0 0 18px rgba(255,107,122,.18);
    }

    .galaxy{
      margin-top:12px;
      border-radius: 16px;
      border:1px solid rgba(130,170,255,.14);
      background: linear-gradient(180deg, rgba(7,10,18,.45), rgba(7,10,18,.15));
      overflow:hidden;
      position:relative;
      padding: 12px;
    }
    .galaxyCanvas{
      width:100%;
      aspect-ratio: 16/8;
      border-radius: 12px;
      background:
        radial-gradient(120px 120px at 16% 55%, rgba(124,247,255,.18), transparent 60%),
        radial-gradient(200px 200px at 70% 55%, rgba(184,167,255,.12), transparent 60%),
        radial-gradient(120px 120px at 88% 40%, rgba(255,208,138,.10), transparent 60%),
        radial-gradient(8px 8px at 30% 40%, rgba(255,255,255,.6), transparent 65%),
        radial-gradient(6px 6px at 55% 65%, rgba(255,255,255,.5), transparent 65%),
        radial-gradient(6px 6px at 75% 35%, rgba(255,255,255,.45), transparent 65%),
        linear-gradient(135deg, rgba(124,247,255,.05), rgba(184,167,255,.06));
      position:relative;
      overflow:hidden;
    }
    .routeLine{
      position:absolute; inset:0;
      background: linear-gradient(90deg, transparent 0 10%, rgba(124,247,255,.08) 10% 11%, transparent 11% 20%,
                                          rgba(184,167,255,.08) 20% 21%, transparent 21% 30%,
                                          rgba(255,208,138,.06) 30% 31%, transparent 31% 40%,
                                          rgba(124,247,255,.06) 40% 41%, transparent 41% 100%);
      mix-blend-mode:screen;
      opacity:.55;
      filter: blur(0.4px);
    }
    .ship{
      position:absolute;
      top: 52%;
      transform: translate(-50%, -50%);
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(124,247,255,.55) 45%, rgba(124,247,255,.12) 68%, transparent 72%);
      box-shadow: 0 0 24px rgba(124,247,255,.28);
      border:1px solid rgba(124,247,255,.30);
    }
    .ship:after{
      content:"";
      position:absolute;
      left:-30px;
      top:50%;
      width: 28px;
      height: 2px;
      transform: translateY(-50%);
      background: linear-gradient(90deg, transparent, rgba(124,247,255,.40), rgba(184,167,255,.20), transparent);
      opacity:.9;
    }
    .center{
      position:absolute;
      left: 92%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.9), rgba(255,208,138,.55) 40%, rgba(255,107,122,.20) 70%, transparent 76%);
      box-shadow: 0 0 34px rgba(255,208,138,.20);
      border:1px solid rgba(255,208,138,.22);
    }
    .legend{
      display:flex;
      justify-content:space-between;
      margin-top:8px;
      color: rgba(223,233,255,.68);
      font-family: var(--mono);
      font-size:11px;
      letter-spacing:.04em;
    }

    .sectionTitle{
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color: rgba(223,233,255,.86);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin:0 0 8px;
    }
    .sectionTitle small{
      color: rgba(223,233,255,.60);
      font-weight:400;
      text-transform:none;
      letter-spacing:0;
      font-family:var(--sans);
      font-size:12px;
    }

    .sceneMeta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }

    .pill{
      font-family: var(--mono);
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid rgba(130,170,255,.14);
      background: rgba(10,16,34,.45);
      color: rgba(223,233,255,.85);
    }
    .pill.cycle{ border-color: rgba(184,167,255,.18); }
    .pill.node{ border-color: rgba(124,247,255,.18); }
    .pill.risk{ border-color: rgba(255,107,122,.22); }

    .narrative{
      line-height:1.55;
      color: rgba(223,233,255,.90);
      font-size: 14px;
      white-space: pre-line;
    }

    .choices{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:12px;
    }
    .choice{
      text-align:left;
      padding: 12px 12px;
      border-radius: 16px;
      border:1px solid rgba(130,170,255,.14);
      background: linear-gradient(180deg, rgba(10,16,34,.55), rgba(10,16,34,.35));
      cursor:pointer;
      transition: transform .08s ease, border-color .18s ease, background .18s ease;
      position:relative;
      overflow:hidden;
    }
    .choice:hover{
      transform: translateY(-1px);
      border-color: rgba(124,247,255,.30);
      background: linear-gradient(180deg, rgba(10,16,34,.62), rgba(10,16,34,.38));
    }
    .choice:active{ transform: translateY(0); }

    .choiceTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .choiceTitle{
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing:.04em;
      margin:0;
      color: rgba(223,233,255,.92);
    }
    .choiceDesc{
      margin:6px 0 0;
      color: rgba(223,233,255,.72);
      font-size: 13px;
      line-height:1.45;
    }
    .delta{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
      min-width: 210px;
    }
    .tag{
      font-family: var(--mono);
      font-size: 11px;
      padding: 4px 8px;
      border-radius:999px;
      border:1px solid rgba(130,170,255,.14);
      background: rgba(7,10,18,.35);
      color: rgba(223,233,255,.84);
      white-space:nowrap;
    }
    .tag.ok{ border-color: rgba(134,255,176,.22); color: rgba(134,255,176,.92); }
    .tag.bad{ border-color: rgba(255,107,122,.26); color: rgba(255,107,122,.92); }
    .tag.neu{ border-color: rgba(255,208,138,.18); color: rgba(255,208,138,.92); }

    .log{
      max-height: 420px;
      overflow:auto;
      padding-right:6px;
    }
    .log::-webkit-scrollbar{ width:10px }
    .log::-webkit-scrollbar-thumb{
      background: rgba(130,170,255,.18);
      border-radius:999px;
      border:2px solid rgba(10,16,34,.50);
    }
    .entry{
      border:1px solid rgba(130,170,255,.12);
      background: linear-gradient(180deg, rgba(10,16,34,.45), rgba(10,16,34,.25));
      border-radius: 16px;
      padding: 10px 10px;
      margin-bottom:10px;
    }
    .entryHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:6px;
    }
    .entryHeader b{
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.04em;
      color: rgba(223,233,255,.90);
    }
    .entryHeader span{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(223,233,255,.55);
    }
    .entry p{
      margin:0;
      color: rgba(223,233,255,.76);
      font-size: 13px;
      line-height:1.45;
      white-space: pre-line;
    }

    .toast{
      position:fixed;
      left:50%;
      bottom:20px;
      transform:translateX(-50%);
      z-index:10;
      max-width: 900px;
      width: calc(100% - 24px);
      background: rgba(10,16,34,.82);
      border:1px solid rgba(130,170,255,.16);
      border-radius: 16px;
      box-shadow: 0 18px 70px rgba(0,0,0,.6);
      padding: 12px 12px;
      display:none;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      backdrop-filter: blur(10px);
    }
    .toast.show{ display:flex; animation: pop .16s ease-out; }
    @keyframes pop{ from{ transform:translateX(-50%) translateY(6px); opacity:.2 } to{ transform:translateX(-50%) translateY(0); opacity:1 } }
    .toast .msg{
      color: rgba(223,233,255,.85);
      font-size: 13px;
      line-height:1.45;
      white-space: pre-line;
    }
    .toast .close{
      flex:0 0 auto;
      border:none;
      background: transparent;
      color: rgba(223,233,255,.75);
      font-family: var(--mono);
      cursor:pointer;
      padding: 6px 8px;
      border-radius: 12px;
    }
    .toast .close:hover{ background: rgba(255,255,255,.06); }

    .ending{
      text-align:center;
      padding: 20px 12px;
    }
    .ending h2{
      margin: 0 0 8px;
      font-family: var(--mono);
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size: 14px;
    }
    .ending p{
      margin: 0 auto 14px;
      max-width: 680px;
      color: rgba(223,233,255,.80);
      line-height:1.5;
    }
    .flashDanger{
      animation: dangerFlash .35s ease;
    }
    @keyframes dangerFlash{
      0%{ filter: none; }
      35%{ filter: drop-shadow(0 0 18px rgba(255,107,122,.26)); }
      100%{ filter:none; }
    }
  </style>
</head>
<body>
  <div class="starfield"></div>
  <div class="scanlines"></div>

  <div class="wrap">
    <header>
      <div class="brand">
        <div class="title">
          <div class="sigil" aria-hidden="true"></div>
          <div>
            <h1>CBONDS: –ü–æ–ª—ë—Ç –∫ –¶–µ–Ω—Ç—Ä—É –ì–∞–ª–∞–∫—Ç–∏–∫–∏</h1>
            <p class="subtitle">
              –í—ã ‚Äî –∫–∞–ø–∏—Ç–∞–Ω –∫–æ—Ä–∞–±–ª—è (–≤–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–æ–¥—É–∫—Ç–∞). –ö–∞–∂–¥—ã–π –≤—ã–±–æ—Ä –º–µ–Ω—è–µ—Ç —Å—Ç—Ä–µ—Å—Å –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å. –í–∞—à–∞ —Ü–µ–ª—å ‚Äî –¥–æ–≤–µ—Å—Ç–∏ –º–∏—Å—Å–∏–∏ –¥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
              –∏ –Ω–µ —Å–≥–æ—Ä–µ—Ç—å –≤ –≥–∏–ø–µ—Ä–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ.
            </p>
          </div>
        </div>
      </div>
      <div class="topActions">
        <button class="btn secondary" id="btnHelp">–°–ø—Ä–∞–≤–∫–∞</button>
        <button class="btn" id="btnSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn" id="btnLoad">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        <button class="btn danger" id="btnReset">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: scene -->
      <section class="card" aria-label="–°—Ü–µ–Ω–∞">
        <div class="cardInner">
          <div class="sectionTitle">
            <span>–ü–∞–Ω–µ–ª—å –∫–∞–ø–∏—Ç–∞–Ω–∞</span>
            <small id="clock">–°–∏—Å—Ç–µ–º–∞: CBONDS-FLEET / –ö–∞–Ω–∞–ª: –±–µ–∑–æ–ø–∞—Å–Ω—ã–π</small>
          </div>

          <div class="hud">
            <div class="hudRow">
              <div class="hudLabel">üöÄ –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—ë—Ç–∞</div>
              <div class="bar" aria-label="–ü—Ä–æ–≥—Ä–µ—Å—Å"><i id="barProgress"></i></div>
              <div class="badge" id="valProgress">0%</div>
            </div>

            <div class="hudRow">
              <div class="hudLabel">üß† –°—Ç—Ä–µ—Å—Å</div>
              <div class="bar danger" aria-label="–°—Ç—Ä–µ—Å—Å"><i id="barStress"></i></div>
              <div class="badge" id="valStress">0%</div>
            </div>

            <div class="hudRow">
              <div class="hudLabel">‚è≥ –¶–∏–∫–ª</div>
              <div class="badge" id="valCycle">1</div>
              <div class="hudLabel">üõ∞ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å —Ñ–ª–æ—Ç–∞</div>
              <div class="badge" id="valFleetLoad">–°—Ä–µ–¥–Ω—è—è</div>
            </div>
          </div>

          <div class="galaxy" aria-label="–ö–∞—Ä—Ç–∞ –≥–∞–ª–∞–∫—Ç–∏–∫–∏">
            <div class="galaxyCanvas" id="galaxyCanvas">
              <div class="routeLine" aria-hidden="true"></div>
              <div class="ship" id="ship"></div>
              <div class="center" aria-hidden="true" title="–¶–µ–Ω—Ç—Ä –ì–∞–ª–∞–∫—Ç–∏–∫–∏"></div>
            </div>
            <div class="legend">
              <span>–ü–ª–∞–Ω–µ—Ç–∞ –ö–ª–∏–µ–Ω—Ç–æ–≤</span>
              <span>–¶–µ–Ω—Ç—Ä –ì–∞–ª–∞–∫—Ç–∏–∫–∏</span>
            </div>
          </div>

          <hr style="border:none;border-top:1px solid rgba(130,170,255,.14); margin:14px 0;" />

          <div class="sectionTitle">
            <span id="sceneTitle">–°—Ü–µ–Ω–∞</span>
            <small id="sceneHint">‚Äî</small>
          </div>

          <div class="sceneMeta">
            <div class="pill cycle" id="sceneCyclePill">–¶–∏–∫–ª 1</div>
            <div class="pill node" id="sceneNodePill">–£–∑–µ–ª: ‚Ä¶</div>
            <div class="pill risk" id="sceneRiskPill" style="display:none;">–†–∏—Å–∫: ‚Ä¶</div>
          </div>

          <div class="narrative" id="sceneText"></div>

          <div class="choices" id="choices"></div>

          <div id="ending" class="ending" style="display:none;"></div>
        </div>
      </section>

      <!-- RIGHT: log -->
      <aside class="card" aria-label="–ñ—É—Ä–Ω–∞–ª">
        <div class="cardInner">
          <div class="sectionTitle">
            <span>–ñ—É—Ä–Ω–∞–ª –ø–æ–ª—ë—Ç–∞</span>
            <small>–°–æ–±—ã—Ç–∏—è –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è</small>
          </div>
          <div class="log" id="log"></div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn secondary" id="btnExport">–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–∞</button>
            <button class="btn" id="btnNext" title="–ï—Å–ª–∏ –≤—ã–±–æ—Ä–æ–≤ –Ω–µ—Ç ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
          </div>
          <p style="margin:10px 0 0; color:rgba(223,233,255,.55); font-size:12px; line-height:1.45;">
            –ü–æ–¥—Å–∫–∞–∑–∫–∞: ¬´–†–µ–ø—É—Ç–∞—Ü–∏—è –≤ –°–æ–≤–µ—Ç–µ¬ª —Å–∫—Ä—ã—Ç–∞, –Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π.
          </p>
        </div>
      </aside>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite">
    <div class="msg" id="toastMsg"></div>
    <button class="close" id="toastClose">–∑–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <script>
    /**********************
     *  GAME DATA
     **********************/
    const FLEET_LOADS = [
      { name: "–ù–∏–∑–∫–∞—è", mod: 1.08 },
      { name: "–°—Ä–µ–¥–Ω—è—è", mod: 1.00 },
      { name: "–í—ã—Å–æ–∫–∞—è", mod: 0.88 },
      { name: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è", mod: 0.78 },
    ];

    // Random ‚Äúasteroid‚Äù disruptions that can appear between stages (chance increases with fleetLoad & stress).
    const ASTEROID_EVENTS = [
      {
        id: "asteroid_hotfix",
        title: "‚òÑ –ê—Å—Ç–µ—Ä–æ–∏–¥–Ω–∞—è —É–≥—Ä–æ–∑–∞",
        text:
`–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª –≤–æ—Ä–≤–∞–ª—Å—è –≤ —Ü–∏–∫–ª –∏ —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è —Ñ–ª–æ—Ç–∞.
–ß–∞—Å—Ç—å –º–∏—Å—Å–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–Ω–µ—Å–µ–Ω–∞ —Å –æ—Ä–±–∏—Ç—ã.`,
        choices: [
          {
            title: "–û—Ç–¥–∞—Ç—å —Å–ª–æ—Ç –∞—Å—Ç–µ—Ä–æ–∏–¥—É (—Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É)",
            desc: "–°–Ω–∏–∑–∏—Ç—å —Ö–∞–æ—Å, –Ω–æ –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å –±–ª–∏–∂–∞–π—à–µ–π –º–∏—Å—Å–∏–µ–π.",
            delta: { stress: -8, progress: -4, rep: +2, fleetLoadStep: -1 },
            note: "–§–ª–æ—Ç –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç –∑–∞ –ø—Ä–∞–≥–º–∞—Ç–∏—á–Ω–æ—Å—Ç—å. –ù–æ –ì–∞–ª–∞–∫—Ç–∏–∫–∞ –ø–æ–º–Ω–∏—Ç –æ—Ç–º–µ–Ω—É."
          },
          {
            title: "–õ–æ–±–±–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ—é –º–∏—Å—Å–∏—é –¥–∞–∂–µ —Å–µ–π—á–∞—Å",
            desc: "–ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ª–æ—Ç —Ü–µ–Ω–æ–π –¥–æ–≤–µ—Ä–∏—è.",
            delta: { stress: +10, progress: +2, rep: -3, fleetLoadStep: +0 },
            check: { base: 0.55, rep: 0.05 }, // success = keep slot
            onSuccess: { stress: -2, progress: +3, rep: +1 },
            onFail: { stress: +6, progress: -6, rep: -2 },
            note: "–≠–ø–∏—á–µ—Å–∫–∞—è –¥—É—ç–ª—å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –≤ –°–æ–≤–µ—Ç–µ."
          },
          {
            title: "–ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –º–∏—Å—Å–∏—é –∫–∞–∫ '–∞—Å—Ç–µ—Ä–æ–∏–¥–Ω—ã–π —â–∏—Ç'",
            desc: "–ü–µ—Ä–µ—É–ø–∞–∫–æ–≤–∞—Ç—å –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É —Ç–∞–∫, —á—Ç–æ–±—ã –µ—ë –Ω–µ–ª—å–∑—è –±—ã–ª–æ –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏–∑ —Ü–∏–∫–ª–∞.",
            delta: { stress: +4, progress: +4, rep: +1, fleetLoadStep: +0 },
            check: { base: 0.62, rep: 0.04 },
            onSuccess: { stress: -4, progress: +4, rep: +2 },
            onFail: { stress: +5, progress: -3, rep: -1 },
            note: "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ—Å–º–æ—Å–∞: —Å–º—ã—Å–ª –º–µ–Ω—è–µ—Ç—Å—è ‚Äî —Ä–µ—Å—É—Ä—Å—ã –æ—Å—Ç–∞—é—Ç—Å—è."
          }
        ]
      },
      {
        id: "asteroid_key_engineer",
        title: "‚òÑ –°–±–æ–π –≤ –∞–Ω–≥–∞—Ä–µ",
        text:
`–ö–ª—é—á–µ–≤–æ–π –∏–Ω–∂–µ–Ω–µ—Ä –∏—Å—á–µ–∑ –≤ –≥–∏–ø–µ—Ä–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –æ—Ç–ø—É—Å–∫–æ–≤.
–°–±–æ—Ä–∫–∞ –∫–æ—Ä–∞–±–ª—è –∑–∞–≤–∏—Å–ª–∞.`,
        choices: [
          {
            title: "–î–∞–≤–∏—Ç—å –∏ –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å (—ç—Å–∫–∞–ª–∞—Ü–∏—è)",
            desc: "–†–∏—Å–∫ –∏—Å–ø–æ—Ä—Ç–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏—è, —à–∞–Ω—Å —É—Å–∫–æ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É.",
            delta: { stress: +8, rep: -1, progress: +1 },
            check: { base: 0.52, rep: 0.05 },
            onSuccess: { stress: -2, progress: +6, rep: +1, fleetLoadStep: -1 },
            onFail: { stress: +6, progress: -2, rep: -2, fleetLoadStep: +0 },
            note: "–ò–Ω–∂–µ–Ω–µ—Ä—ã –∑–∞–Ω—è—Ç—ã —Å–ø–∞—Å–µ–Ω–∏–µ–º –ì–∞–ª–∞–∫—Ç–∏–∫–∏, –Ω–æ –∏–Ω–æ–≥–¥–∞ —Å–ª—ã—à–∞—Ç."
          },
          {
            title: "–°–º–∏—Ä–µ–Ω–Ω–æ –∂–¥–∞—Ç—å",
            desc: "–°–Ω–∏–∑–∏—Ç—å —Å—Ç—Ä–µ—Å—Å, –Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å —Ç–µ–º–ø.",
            delta: { stress: -6, progress: -1, rep: +1, fleetLoadStep: +0 },
            note: "–¢–µ—Ä–ø–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–Ω–∞ ‚Äî —Ä–µ–¥–∫–∏–π —Ä–µ—Å—É—Ä—Å."
          },
          {
            title: "–ü–µ—Ä–µ–∫–∏–Ω—É—Ç—å —á–∞—Å—Ç—å –∑–∞–¥–∞—á –Ω–∞ —à–∞—Ç—Ç–ª IT-—Ñ–ª–æ—Ç–∞",
            desc: "–ë—ã—Å—Ç—Ä–æ —Ä–∞–∑–≥—Ä—É–∑–∏—Ç—å —É–∑–∫–æ–µ –º–µ—Å—Ç–æ.",
            delta: { stress: +3, progress: +3, rep: +1, fleetLoadStep: +1 },
            check: { base: 0.68, rep: 0.03 },
            onSuccess: { stress: -3, progress: +4, rep: +1 },
            onFail: { stress: +4, progress: -2, rep: -1 },
            note: "–ú–∞–Ω—ë–≤—Ä –≤–æ–∑–º–æ–∂–µ–Ω, –µ—Å–ª–∏ –º–∞—Ä—à—Ä—É—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–æ–∫–∞–ª—å–Ω—ã–π."
          }
        ]
      }
    ];

    // Core storyline staged as nodes. Each node has choices. Some have success/fail checks.
    const NODES = [
      {
        id: "signal",
        cyclePhase: "üì° –ü—Ä–∏—ë–º —Å–∏–≥–Ω–∞–ª–∞",
        title: "–ü—Ä–∏—ë–º —Å–∏–≥–Ω–∞–ª–∞ —Å –ø–ª–∞–Ω–µ—Ç—ã –ö–ª–∏–µ–Ω—Ç–æ–≤",
        hint: "–í—Ö–æ–¥—è—â–∏–π —Å–∏–≥–Ω–∞–ª –∏ –ø–µ—Ä–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ",
        text:
`üì° –í—Ö–æ–¥—è—â–∏–π —Å–∏–≥–Ω–∞–ª.
–ü–ª–∞–Ω–µ—Ç–∞: Institutional Clients Prime
–ó–∞–ø—Ä–æ—Å: ¬´–ù–∞–º –Ω—É–∂–Ω–∞ –Ω–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –æ–±–ª–∏–≥–∞—Ü–∏—è–º —Ä–∞–∑–≤–∏–≤–∞—é—â–∏—Ö—Å—è —Ä—ã–Ω–∫–æ–≤¬ª.`,
        choices: [
          {
            title: "–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –Ω–∞ –°–æ–≤–µ—Ç",
            desc: "–°–∫–æ—Ä–æ—Å—Ç—å ‚Äî –≤–∞—à —â–∏—Ç. –ù–æ —Ü–µ–Ω–∞ ‚Äî —Å—Ç—Ä–µ—Å—Å –∏ –≤–Ω–∏–º–∞–Ω–∏–µ.",
            delta: { progress: +5, stress: +10, rep: +1 },
            note: "–ö–∞–ø–∏—Ç–∞–Ω –ø—Ä–æ—è–≤–ª—è–µ—Ç –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É. –°–æ–≤–µ—Ç –Ω–∞—Å—Ç–æ—Ä–æ–∂–µ–Ω."
          },
          {
            title: "–ó–∞–ø—Ä–æ—Å–∏—Ç—å —É—Ç–æ—á–Ω–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π",
            desc: "–°–Ω–∞—á–∞–ª–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏, –ø–æ—Ç–æ–º ‚Äî –ø—Ä—ã–∂–æ–∫.",
            delta: { progress: +2, stress: -5, rep: +2 },
            note: "–°–æ–≤–µ—Ç –¥–æ–≤–æ–ª–µ–Ω –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é. –ö–ª–∏–µ–Ω—Ç—ã –≤–æ—Ä—á–∞—Ç."
          },
          {
            title: "–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª",
            desc: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã —Å–µ–π—á–∞—Å, —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–æ–≤–µ—Ä–∏–µ –ø–ª–∞–Ω–µ—Ç—ã.",
            delta: { progress: -5, stress: -10, rep: -1 },
            note: "–ì–∞–ª–∞–∫—Ç–∏–∫–∞ –Ω–µ –∑–∞–º–µ—Ç–∏–ª–∞ –ø–æ—Ç–µ—Ä—é. –ö–ª–∏–µ–Ω—Ç—ã ‚Äî –¥–∞."
          }
        ],
      },

      {
        id: "council_comms",
        cyclePhase: "ü™ê –°–æ–≤–µ—Ç",
        title: "–°–æ–≤–µ—Ç –ú–µ–∂–∑–≤—ë–∑–¥–Ω–æ–π –°–≤—è–∑–∏",
        hint: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –¥–∏–ø–ª–æ–º–∞—Ç–∏–∏",
        text:
`–í –°–æ–≤–µ—Ç–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç:
‚Äî –ì–ª–∞–≤–Ω–æ–∫–æ–º–∞–Ω–¥—É—é—â–∏–π —Ñ–ª–æ—Ç–æ–º
‚Äî –û—Å–Ω–æ–≤–∞—Ç–µ–ª—å –í—Å–µ–ª–µ–Ω–Ω–æ–π
‚Äî –•—Ä–∞–Ω–∏—Ç–µ–ª—å –¢–æ—Ä–≥–æ–≤—ã—Ö –ü—É—Ç–µ–π
‚Äî –∫–æ–º–∞–Ω–¥–∏—Ä—ã –æ—Ç—Å–µ–∫–æ–≤ –∏ –æ—Ñ–∏—Ü–µ—Ä—ã —Å–≤—è–∑–∏

–í–æ–ø—Ä–æ—Å –∑–≤—É—á–∏—Ç –ø—Ä–æ—Å—Ç–æ: ¬´–ó–∞—á–µ–º —ç—Ç–∞ –º–∏—Å—Å–∏—è –Ω—É–∂–Ω–∞ –ì–∞–ª–∞–∫—Ç–∏–∫–µ?¬ª`,
        choices: [
          {
            title: "–ì–æ–≤–æ—Ä–∏—Ç—å –ø—Ä–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å",
            desc: "–°—Ç–∞–≤–∫–∞ –Ω–∞ –¥–æ–ª–≥–∏–π –≥–æ—Ä–∏–∑–æ–Ω—Ç: —Ä—ã–Ω–æ–∫, –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è.",
            delta: { stress: +2, rep: +1 },
            check: { base: 0.62, rep: 0.05 },
            onSuccess: { progress: +8, stress: -2, rep: +2 },
            onFail: { progress: +1, stress: +8, rep: -1 },
            note: "–°–æ–≤–µ—Ç –ª—é–±–∏—Ç –º–∞—Å—à—Ç–∞–±, –Ω–æ –Ω–µ–Ω–∞–≤–∏–¥–∏—Ç —Ç—É–º–∞–Ω."
          },
          {
            title: "–î–∞–≤–∏—Ç—å –Ω–∞ —Å—Ä–æ—á–Ω–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤",
            desc: "–°—Ç–∞–≤–∫–∞ –Ω–∞ –¥–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é: —Ä–∏—Å–∫ –ø–µ—Ä–µ–≥—Ä–µ–≤–∞.",
            delta: { progress: +3, stress: +5, rep: +0 },
            check: { base: 0.65, rep: 0.03 },
            onSuccess: { progress: +5, stress: -1, rep: +1 },
            onFail: { progress: -2, stress: +6, rep: -2 },
            note: "–°—Ä–æ—á–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–∫–∞ –≤—ã –Ω–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç–µ."
          },
          {
            title: "–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å MVP-–º–∏—Å—Å–∏—é",
            desc: "–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä—ã–∂–æ–∫: –±—ã—Å—Ç—Ä–µ–µ –ø–æ–ª—É—á–∏—Ç—å —Å–∏–≥–Ω–∞–ª —Ü–µ–Ω–Ω–æ—Å—Ç–∏.",
            delta: { progress: +4, stress: -3, rep: +2 },
            note: "–°–æ–≤–µ—Ç –≤–∏–¥–∏—Ç —É–ø—Ä–∞–≤–ª—è–µ–º—É—é —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é. –®–∞–Ω—Å—ã —Ä–∞—Å—Ç—É—Ç."
          }
        ]
      },

      {
        id: "star_map",
        cyclePhase: "üó∫ –ö–∞—Ä—Ç–∞",
        title: "–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∑–≤—ë–∑–¥–Ω–æ–π –∫–∞—Ä—Ç—ã –º–∏—Å—Å–∏–π",
        hint: "–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —à–∞–Ω—Å —Å—Ç–∞—Ä—Ç–∞",
        text:
`–û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –º–∏—Å—Å–∏–∏ –Ω–∞–Ω–æ—Å—è—Ç—Å—è –Ω–∞ –ó–≤—ë–∑–¥–Ω—É—é –∫–∞—Ä—Ç—É.
–í–∞–º –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–π –º–∏—Å—Å–∏–∏.

‚ö† –ß–µ–º –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Äî —Ç–µ–º –≤—ã—à–µ —à–∞–Ω—Å —Å—Ç–∞—Ä—Ç–∞.
–ù–æ —Ä–∞—Å—Ç—ë—Ç —Å—Ç—Ä–µ—Å—Å –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –∑–∞ —Å–ª–æ—Ç.`,
        choices: [
          {
            title: "üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è",
            desc: "–°—Ä–∞–∑—É –≤ –±–æ–π –∑–∞ —Å–ª–æ—Ç –∑–∞–ø—É—Å–∫–∞.",
            delta: { progress: +3, stress: +6, rep: +1, fleetLoadStep: +1 },
            note: "–í—ã –±—Ä–æ—Å–∏–ª–∏ –≤—ã–∑–æ–≤ –¥—Ä—É–≥–∏–º –∫–∞–ø–∏—Ç–∞–Ω–∞–º."
          },
          {
            title: "üü° –í–∞–∂–Ω–∞—è",
            desc: "–ë–∞–ª–∞–Ω—Å: —à–∞–Ω—Å —Å—Ç–∞—Ä—Ç–∞ –≤—ã—Å–æ–∫–∏–π, –Ω–æ –±–µ–∑ —Ç–æ—Ç–∞–ª—å–Ω–æ–π –≤–æ–π–Ω—ã.",
            delta: { progress: +2, stress: +2, rep: +1, fleetLoadStep: +0 },
            note: "–†–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä ‚Äî —Ä–µ–¥–∫–æ—Å—Ç—å –≤ –∫–æ—Å–º–æ—Å–µ."
          },
          {
            title: "üîµ –§–æ–Ω–æ–≤–∞—è",
            desc: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –∏ –∂–¥–∞—Ç—å –æ–∫–Ω–∞.",
            delta: { progress: +1, stress: -2, rep: +0, fleetLoadStep: -1 },
            note: "–ú–∏—Å—Å–∏—è –Ω–µ –ø–æ—Ç–µ—Ä—è–Ω–∞. –û–Ω–∞ –ø—Ä–æ—Å—Ç–æ —É—à–ª–∞ –≤ —Ç–µ–Ω—å."
          }
        ]
      },

      {
        id: "ship_type",
        cyclePhase: "üö¢ –§–ª–æ—Ç",
        title: "–í—ã–±–æ—Ä —Ç–∏–ø–∞ –∑–≤–µ–∑–¥–æ–ª—ë—Ç–∞",
        hint: "–¢—è–∂—ë–ª—ã–π –∫—Ä–µ–π—Å–µ—Ä –∏–ª–∏ –º–∞–Ω—ë–≤—Ä–µ–Ω–Ω—ã–π —à–∞—Ç—Ç–ª",
        text:
`–ö–∞–ø–∏—Ç–∞–Ω –ø—Ä–æ–¥—É–∫—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–∞—Ä—à—Ä—É—Ç:

üö¢ –¢—è–∂—ë–ª—ã–π –∫—Ä–µ–π—Å–µ—Ä –ö–æ—Ä–ø—É—Å–∞ –†–∞–∑–≤–∏—Ç–∏—è ‚Äî –¥–∞–ª—å–Ω–∏–µ –∏ —Å–ª–æ–∂–Ω—ã–µ —ç–∫—Å–ø–µ–¥–∏—Ü–∏–∏ (–±–æ–ª—å—à–µ –≤—ã–≥–æ–¥–∞, –¥–æ–ª—å—à–µ –æ–∂–∏–¥–∞–Ω–∏–µ).
üõ∏ –ú–∞–Ω—ë–≤—Ä–µ–Ω–Ω—ã–π —à–∞—Ç—Ç–ª IT-—Ñ–ª–æ—Ç–∞ ‚Äî –±—ã—Å—Ç—Ä—ã–µ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–±—ã—Å—Ç—Ä–µ–µ –∑–∞–ø—É—Å–∫, —Ä–∏—Å–∫ –ø–µ—Ä–µ–¥–µ–ª–æ–∫).`,
        choices: [
          {
            title: "üö¢ –¢—è–∂—ë–ª—ã–π –∫—Ä–µ–π—Å–µ—Ä –ö–æ—Ä–ø—É—Å–∞ –†–∞–∑–≤–∏—Ç–∏—è",
            desc: "–ë–æ–ª—å—à–∞—è —Å—Ç–∞–≤–∫–∞: –≤—ã—Å–æ–∫–∞—è –æ—Ç–¥–∞—á–∞, –Ω–æ –æ—á–µ—Ä–µ–¥—å –∏ —Å–±–æ—Ä–∫–∞.",
            delta: { stress: +10, rep: +1 },
            check: { base: 0.60, rep: 0.05 }, // admission on council
            onSuccess: { progress: +6, stress: -2, rep: +2, setFlag: "pathHeavy" },
            onFail: { progress: -2, stress: +6, rep: -2, setFlag: "pathHeavy" },
            note: "–í–µ—Ä—Ö–æ–≤–Ω—ã–π –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –ª—é–±–∏—Ç –ø–æ—Ä—è–¥–æ–∫ –∏ —Ä–∞—Å—á—ë—Ç."
          },
          {
            title: "üõ∏ –ú–∞–Ω—ë–≤—Ä–µ–Ω–Ω—ã–π —à–∞—Ç—Ç–ª IT-—Ñ–ª–æ—Ç–∞",
            desc: "–ë—ã—Å—Ç—Ä–∞—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è: –º–µ–Ω—å—à–µ –±—é—Ä–æ–∫—Ä–∞—Ç–∏–∏, –±–æ–ª—å—à–µ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ—Å—Ç–µ–π.",
            delta: { progress: +4, stress: +2, rep: +1, setFlag: "pathShuttle" },
            note: "–ï—Å–ª–∏ –º–∏—Å—Å–∏—è –ª–æ–∫–∞–ª—å–Ω–∞—è ‚Äî —à–∞—Ç—Ç–ª –∏–¥–µ–∞–ª–µ–Ω."
          }
        ]
      },

      {
        id: "dev_corps_council",
        cyclePhase: "üèõ –°–æ–≤–µ—Ç",
        title: "–°–æ–≤–µ—Ç –ö–æ—Ä–ø—É—Å–∞ –†–∞–∑–≤–∏—Ç–∏—è",
        hint: "–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–ª–∏ —Ç—è–∂—ë–ª—ã–π –∫—Ä–µ–π—Å–µ—Ä",
        gate: (s)=> s.flags.pathHeavy === true,
        text:
`–í—Å–µ –Ω–æ–≤—ã–µ —ç–∫—Å–ø–µ–¥–∏—Ü–∏–∏ –¥–ª—è —Ç—è–∂—ë–ª–æ–≥–æ —Ñ–ª–æ—Ç–∞ –≤—ã–Ω–æ—Å—è—Ç—Å—è –Ω–∞ –°–æ–≤–µ—Ç –ö–æ—Ä–ø—É—Å–∞ –†–∞–∑–≤–∏—Ç–∏—è.
–ì–ª–∞–≤–Ω–æ–∫–æ–º–∞–Ω–¥—É—é—â–∏–π –∏ –í–µ—Ä—Ö–æ–≤–Ω—ã–π –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä —Å–º–æ—Ç—Ä—è—Ç –Ω–∞ –≤–∞—Å, –∫–∞–∫ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –≤ —à—Ç–æ—Ä–º.

–§—Ä–∞–∑–∞ –∑–≤—É—á–∏—Ç —Ö–æ–ª–æ–¥–Ω–æ: ¬´–î–æ–ø—É—Å–∫–∞—Ç—å –º–∏—Å—Å–∏—é –∫ —Å—Ç–∞—Ä—Ç—É –∏–ª–∏ –Ω–µ—Ç?¬ª`,
        choices: [
          {
            title: "–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å—á—ë—Ç —Ü–µ–Ω–Ω–æ—Å—Ç–∏ (ROI/impact) –∏ —Ä–∏—Å–∫–æ–≤",
            desc: "–ñ—ë—Å—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –º–∏–Ω–∏–º—É–º —Ç—É–º–∞–Ω–∞.",
            delta: { stress: +3, rep: +2 },
            check: { base: 0.70, rep: 0.05 },
            onSuccess: { progress: +10, stress: -4, rep: +2 },
            onFail: { progress: -3, stress: +7, rep: -3 },
            note: "–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä —É–≤–∞–∂–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –∏ —è—Å–Ω–æ—Å—Ç—å."
          },
          {
            title: "–ü–æ–ø—Ä–æ—Å–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç (Pilot/MVP) –Ω–∞ –∫—Ä–µ–π—Å–µ—Ä–µ",
            desc: "–ö–æ–º–ø—Ä–æ–º–∏—Å—Å: —Ç—è–∂—ë–ª—ã–π —Ñ–ª–æ—Ç, –Ω–æ –º–∞–ª—ã–π –æ–±—ä—ë–º.",
            delta: { progress: +5, stress: +1, rep: +1 },
            check: { base: 0.66, rep: 0.04 },
            onSuccess: { progress: +6, stress: -2, rep: +2 },
            onFail: { progress: 0, stress: +5, rep: -2 },
            note: "–ö–æ–º–ø—Ä–æ–º–∏—Å—Å –∏–Ω–æ–≥–¥–∞ —Å–ø–∞—Å–∞–µ—Ç –º–∏—Å—Å–∏—é, –∏–Ω–æ–≥–¥–∞ ‚Äî —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç –≤—Å–µ—Ö."
          },
          {
            title: "–°–¥–µ–ª–∞—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∏—Ç—á –ø—Ä–æ –∫–ª–∏–µ–Ω—Ç–æ–≤",
            desc: "–†–∏—Å–∫–æ–≤–∞–Ω–Ω–æ: —ç—Ç–æ –Ω–µ —Ç–æ—Ç –°–æ–≤–µ—Ç, –≥–¥–µ –ª—é–±—è—Ç —ç–º–æ—Ü–∏–∏.",
            delta: { stress: +6, rep: -1 },
            check: { base: 0.52, rep: 0.03 },
            onSuccess: { progress: +8, stress: -2, rep: +1 },
            onFail: { progress: -4, stress: +9, rep: -3 },
            note: "–ò–Ω–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç. –ß–∞—â–µ ‚Äî –Ω–µ—Ç."
          }
        ]
      },

      {
        id: "direct_fleet_council",
        cyclePhase: "üèõ –°–æ–≤–µ—Ç",
        title: "–ü—Ä—è–º–æ–π –≤—ã—Ö–æ–¥ –Ω–∞ –°–æ–≤–µ—Ç –§–ª–æ—Ç–∞",
        hint: "–ï—Å–ª–∏ –º–∏—Å—Å–∏—è –∏–¥—ë—Ç —à–∞—Ç—Ç–ª–æ–º (–∏–ª–∏ –∫—Ä–µ–π—Å–µ—Ä –æ—Ç–∫–∞–∑–∞–ª–∏ ‚Äî –≤—ã –∏—â–µ—Ç–µ –æ–±—Ö–æ–¥)",
        gate: (s)=> s.flags.pathShuttle === true || s.flags.pathHeavy === true,
        text:
`–ï—Å–ª–∏ –º–∏—Å—Å–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ç—è–∂—ë–ª—ã—Ö –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã—Ö –¥–æ—Ä–∞–±–æ—Ç–æ–∫ ‚Äî –∫–∞–ø–∏—Ç–∞–Ω –≤—ã—Ö–æ–¥–∏—Ç –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ –°–æ–≤–µ—Ç –§–ª–æ—Ç–∞.
–¢–∞–º –≤—ã –∑–∞—â–∏—â–∞–µ—Ç–µ –º–∞—Ä—à—Ä—É—Ç –ø–µ—Ä–µ–¥:
‚Äî –ì–ª–∞–≤–Ω–æ–∫–æ–º–∞–Ω–¥—É—é—â–∏–º
‚Äî –í–µ—Ä—Ö–æ–≤–Ω—ã–º –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–æ–º
‚Äî –ê–¥–º–∏—Ä–∞–ª–æ–º –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–π

–í–æ–ø—Ä–æ—Å: ¬´–ö–∞–∫ –±—ã—Å—Ç—Ä–æ –≤—ã –¥–∞–¥–∏—Ç–µ —ç—Ñ—Ñ–µ–∫—Ç –∏ –Ω–∞—Å–∫–æ–ª—å–∫–æ —á—ë—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–∞ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è?¬ª`,
        choices: [
          {
            title: "–°–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ (–±—ã—Å—Ç—Ä—ã–π —ç—Ñ—Ñ–µ–∫—Ç)",
            desc: "–ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –≤—ã —Å–º–æ–∂–µ—Ç–µ –¥–∞—Ç—å —Å–∏–≥–Ω–∞–ª —Ü–µ–Ω–Ω–æ—Å—Ç–∏ —É–∂–µ –≤ —ç—Ç–æ–º —Ü–∏–∫–ª–µ.",
            delta: { progress: +3, stress: +4, rep: +1 },
            check: { base: 0.67, rep: 0.04 },
            onSuccess: { progress: +6, stress: -2, rep: +1 },
            onFail: { progress: -2, stress: +6, rep: -2 },
            note: "–°–∫–æ—Ä–æ—Å—Ç—å ‚Äî –≤–∞–ª—é—Ç–∞, –Ω–æ –Ω–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è."
          },
          {
            title: "–°–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —è—Å–Ω–æ—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–∞",
            desc: "–ñ—ë—Å—Ç–∫–æ —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –≥—Ä–∞–Ω–∏—Ü—ã.",
            delta: { progress: +2, stress: +1, rep: +2 },
            check: { base: 0.72, rep: 0.05 },
            onSuccess: { progress: +7, stress: -3, rep: +2 },
            onFail: { progress: 0, stress: +4, rep: -1 },
            note: "–¢—É–º–∞–Ω ‚Äî –≥–ª–∞–≤–Ω—ã–π –≤—Ä–∞–≥ –≤ –≥–∏–ø–µ—Ä–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ."
          },
          {
            title: "–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–∞–∫–µ—Ç: MVP + –¥–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞",
            desc: "–°–Ω—è—Ç—å —Å—Ç—Ä–∞—Ö–∏ –∏ –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –º–∞—Å—à—Ç–∞–±.",
            delta: { progress: +4, stress: +2, rep: +1 },
            check: { base: 0.69, rep: 0.04 },
            onSuccess: { progress: +6, stress: -3, rep: +2 },
            onFail: { progress: -1, stress: +5, rep: -2 },
            note: "–•–æ—Ä–æ—à–∏–π —Ö–æ–¥, –µ—Å–ª–∏ –≤—ã —Ä–µ–∞–ª—å–Ω–æ –≥–æ—Ç–æ–≤—ã –¥–µ—Ä–∂–∞—Ç—å —Ñ–æ–∫—É—Å."
          }
        ]
      },

      {
        id: "trajectory_review",
        cyclePhase: "üß≠ –†–∞–∑–±–æ—Ä",
        title: "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏",
        hint: "–ï—Å–ª–∏ –º–∞—Ä—à—Ä—É—Ç —Ç—É–º–∞–Ω–µ–Ω ‚Äî –º–∏—Å—Å–∏—é –≤–µ—Ä–Ω—É—Ç –Ω–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫—É",
        text:
`–°–æ–±–∏—Ä–∞—é—Ç—Å—è –∞–¥–º–∏—Ä–∞–ª—ã —Ñ–ª–æ—Ç–∞, –≤–µ–¥—É—â–∏–µ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä—ã –∏ —Å—Ç–∞—Ä—à–∏–µ –∏–Ω–∂–µ–Ω–µ—Ä—ã.
–ù–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è —ç—Å–∫–∞–¥—Ä–∞, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ–ª—ë—Ç.

‚ö† –ï—Å–ª–∏ –º–∞—Ä—à—Ä—É—Ç –æ–ø–∏—Å–∞–Ω —Ç—É–º–∞–Ω–Ω–æ ‚Äî –º–∏—Å—Å–∏—é –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫–∞–ø–∏—Ç–∞–Ω—É –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∫–∞–ª–∏–±—Ä–æ–≤–∫—É.`,
        choices: [
          {
            title: "–£—Ç–æ—á–Ω–∏—Ç—å –¢–ó –∏ –≥—Ä–∞–Ω–∏—Ü—ã –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å",
            desc: "–ú–µ–Ω—å—à–µ –≥–µ—Ä–æ–∏–∑–º–∞ ‚Äî –±–æ–ª—å—à–µ —Ç–æ—á–Ω–æ—Å—Ç–∏.",
            delta: { progress: +3, stress: +5, rep: +2 },
            note: "–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ —Ç—Ä–µ–±—É–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏, –Ω–æ —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ –∞–≤–∞—Ä–∏–∏."
          },
          {
            title: "–°–∫–∞–∑–∞—Ç—å: ¬´–∏ —Ç–∞–∫ –ø–æ–Ω—è—Ç–Ω–æ¬ª",
            desc: "–°–∫–æ—Ä–æ—Å—Ç—å –≤ –æ–±–º–µ–Ω –Ω–∞ —Ä–∏—Å–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞.",
            delta: { stress: +3, rep: -1 },
            check: { base: 0.50, rep: 0.05 },
            onSuccess: { progress: +6, stress: -1, rep: +1 },
            onFail: { progress: -5, stress: +8, rep: -3, setFlag: "needsRecalibration" },
            note: "–¢—É–º–∞–Ω –≤ –º–∞—Ä—à—Ä—É—Ç–µ –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –±—É–º–µ—Ä–∞–Ω–≥–æ–º."
          },
          {
            title: "–°–æ–±—Ä–∞—Ç—å –º–∏–Ω–∏-—Å–µ—Å—Å–∏—é —Å –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–∞–º–∏ (30 –º–∏–Ω—É—Ç)",
            desc: "–£–±—Ä–∞—Ç—å —Å–∞–º—ã–µ –æ–ø–∞—Å–Ω—ã–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ.",
            delta: { progress: +4, stress: +2, rep: +1 },
            check: { base: 0.70, rep: 0.04 },
            onSuccess: { progress: +5, stress: -3, rep: +1 },
            onFail: { progress: -1, stress: +4, rep: -1 },
            note: "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–ø–∞—Å–∞–µ—Ç —Ü–∏–∫–ª—ã."
          }
        ]
      },

      {
        id: "fuel_calc",
        cyclePhase: "‚õΩ –†–∞—Å—á—ë—Ç",
        title: "–†–∞—Å—á—ë—Ç —Ç–æ–ø–ª–∏–≤–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏ –≤ –≥–∏–ø–µ—Ä–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ",
        hint: "–û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –∑–∞–ø—É—Å–∫",
        text:
`–ú–∏—Å—Å–∏—è –ø–æ–ª—É—á–∞–µ—Ç –æ—Ü–µ–Ω–∫—É —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –∑–∞–ø—É—Å–∫.

‚Äî –ú–∞–ª–æ —Ç–æ–ø–ª–∏–≤–∞ ‚Üí –±—ã—Å—Ç—Ä—ã–π –ø—Ä—ã–∂–æ–∫
‚Äî –ú–Ω–æ–≥–æ —Ç–æ–ø–ª–∏–≤–∞ ‚Üí –≤–æ–∑–º–æ–∂–Ω–æ, —ç–∫—Å–ø–µ–¥–∏—Ü–∏—è –Ω–∞ –≥–æ–¥—ã

–í–∞–º –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥:`,
        choices: [
          {
            title: "–≠–∫–æ–Ω–æ–º–∏—Ç—å —Ç–æ–ø–ª–∏–≤–æ (–±—ã—Å—Ç—Ä—ã–π –ø—Ä—ã–∂–æ–∫)",
            desc: "–°–∂–∞—Ç—å –æ–±—ä—ë–º, —á—Ç–æ–±—ã —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å —Ä–∞–Ω—å—à–µ.",
            delta: { progress: +5, stress: +2, rep: +1, setFlag: "fuelLight" },
            note: "–ö–æ—Ä–æ—Ç–∫–∏–π –ø—Ä—ã–∂–æ–∫ ‚Äî –º–µ–Ω—å—à–µ —Ä–∏—Å–∫–∞, –Ω–æ –∏ –º–µ–Ω—å—à–µ –æ—Ö–≤–∞—Ç."
          },
          {
            title: "–ó–∞–ø—Ä–æ—Å–∏—Ç—å –±–æ–ª—å—à–µ —Ç–æ–ø–ª–∏–≤–∞ (–±–æ–ª—å—à–æ–π –æ—Ö–≤–∞—Ç)",
            desc: "–°—Ç–∞–≤–∫–∞ –Ω–∞ –º–∞—Å—à—Ç–∞–± –∏ –∫–∞—á–µ—Å—Ç–≤–æ, –Ω–æ –æ—á–µ—Ä–µ–¥—å –º–æ–∂–µ—Ç —É–¥–ª–∏–Ω–∏—Ç—å—Å—è.",
            delta: { progress: +3, stress: +6, rep: +1, fleetLoadStep: +1, setFlag: "fuelHeavy" },
            check: { base: 0.62, rep: 0.04 },
            onSuccess: { progress: +6, stress: -1, rep: +1 },
            onFail: { progress: -2, stress: +5, rep: -2 },
            note: "–ë–æ–ª—å—à–∞—è —Å—Ç–∞–≤–∫–∞ —Ä–µ–¥–∫–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –±–æ—è."
          },
          {
            title: "–°–º–µ—à–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º (MVP —Å–µ–π—á–∞—Å, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ—Ç–æ–º)",
            desc: "–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∫–æ–º–ø—Ä–æ–º–∏—Å—Å, –µ—Å–ª–∏ –≤—ã —É–¥–µ—Ä–∂–∏—Ç–µ —Ñ–æ–∫—É—Å.",
            delta: { progress: +4, stress: +3, rep: +2, setFlag: "fuelHybrid" },
            note: "–î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ ‚Äî –≤–∞—à –∞–Ω—Ç–∏–¥–æ—Ç –æ—Ç scope creep."
          }
        ]
      },

      {
        id: "big_council",
        cyclePhase: "‚öî –ë–æ–ª—å—à–æ–π –°–æ–≤–µ—Ç",
        title: "–°–æ–≤–µ—Ç –ø–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—é –±–æ–µ–≤–æ–≥–æ –≤—ã–ª–µ—Ç–∞",
        hint: "–ë–∏—Ç–≤–∞ –∑–∞ —Å–ª–æ—Ç –∑–∞–ø—É—Å–∫–∞ (—Ä–∞–∑ –≤ –¥–≤–µ –Ω–µ–¥–µ–ª–∏)",
        text:
`–†–∞–∑ –≤ –¥–≤–µ –Ω–µ–¥–µ–ª–∏ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ë–æ–ª—å—à–æ–π –°–æ–≤–µ—Ç –§–ª–æ—Ç–∞.
–û–Ω —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –º–∏—Å—Å–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –ø–æ–ª–µ—Ç—è—Ç –≤ –±–ª–∏–∂–∞–π—à–∏–π —Ü–∏–∫–ª.

–ó–¥–µ—Å—å —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è —ç–ø–∏—á–µ—Å–∫–∏–µ —Å—Ä–∞–∂–µ–Ω–∏—è –∑–∞ –∫–∞–∂–¥—ã–π —Å–ª–æ—Ç –∑–∞–ø—É—Å–∫–∞.`,
        choices: [
          {
            title: "–õ–æ–±–±–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç –Ω–∞–ø—Ä—è–º—É—é",
            desc: "–ñ—ë—Å—Ç–∫–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ –≤ –°–æ–≤–µ—Ç–µ ‚Äî –¥–æ—Ä–æ–≥–æ –ø–æ —Å—Ç—Ä–µ—Å—Å—É.",
            delta: { stress: +8, rep: -1 },
            check: { base: 0.60, rep: 0.06 },
            onSuccess: { progress: +10, stress: -3, rep: +2, setFlag: "gotSlot" },
            onFail: { progress: -3, stress: +8, rep: -3, setFlag: "missedSlot" },
            note: "–°–ª–æ—Ç –ø–æ–ª—É—á–∞—é—Ç –Ω–∞—Å—Ç–æ–π—á–∏–≤—ã–µ. –ò–Ω–æ–≥–¥–∞ ‚Äî —Å–ª–∏—à–∫–æ–º –Ω–∞—Å—Ç–æ–π—á–∏–≤—ã–µ."
          },
          {
            title: "–û–±–º–µ–Ω—è—Ç—å—Å—è —Å–ª–æ—Ç–∞–º–∏ (–¥–∏–ø–ª–æ–º–∞—Ç–∏—è)",
            desc: "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è.",
            delta: { stress: +2, rep: +2 },
            check: { base: 0.68, rep: 0.05 },
            onSuccess: { progress: +8, stress: -2, rep: +2, setFlag: "gotSlot" },
            onFail: { progress: -2, stress: +4, rep: -1, setFlag: "missedSlot" },
            note: "–õ—É—á—à–∏–µ –∫–∞–ø–∏—Ç–∞–Ω—ã —É–º–µ—é—Ç –º–µ–Ω—è—Ç—å—Å—è —Ä–µ—Å—É—Ä—Å–∞–º–∏."
          },
          {
            title: "–î–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ —Å–Ω—è—Ç—å –º–∏—Å—Å–∏—é –Ω–∞ —Ü–∏–∫–ª (—Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞—è –ø–∞—É–∑–∞)",
            desc: "–°–Ω–∏–∑–∏—Ç—å –ø–µ—Ä–µ–≥—Ä–µ–≤ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é –ª—É—á—à–µ.",
            delta: { progress: -2, stress: -10, rep: +1, setFlag: "pausedSlot" },
            note: "–ò–Ω–æ–≥–¥–∞ –ª—É—á—à–∏–π –±–æ–π ‚Äî —Ç–æ—Ç, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ –±—ã–ª–æ."
          }
        ]
      },

      {
        id: "trajectory_window",
        cyclePhase: "ü™ü –û–∫–Ω–æ",
        title: "–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏",
        hint: "–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–∫–Ω–æ –ø–æ—Å–ª–µ –°–æ–≤–µ—Ç–∞",
        text:
`–ü–æ—Å–ª–µ –°–æ–≤–µ—Ç–∞ –µ—Å—Ç—å –∫–æ—Ä–æ—Ç–∫–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞.
–ö–∞–ø–∏—Ç–∞–Ω—ã –º–∏—Å—Å–∏–π –Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç –∑–∞–ø—Ä–æ—Å—ã –ì–ª–∞–≤–Ω–æ–∫–æ–º–∞–Ω–¥—É—é—â–µ–º—É:
–∏–Ω–æ–≥–¥–∞ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –º–µ–Ω—è–µ—Ç—Å—è, –∏–Ω–æ–≥–¥–∞ ‚Äî –Ω–µ—Ç.`,
        choices: [
          {
            title: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏",
            desc: "–®–∞–Ω—Å —É–ª—É—á—à–∏—Ç—å —à–∞–Ω—Å—ã –º–∏—Å—Å–∏–∏, –Ω–æ –º–æ–∂–Ω–æ —Ä–∞–∑–æ–∑–ª–∏—Ç—å –°–æ–≤–µ—Ç.",
            delta: { stress: +4, rep: +0 },
            check: { base: 0.64, rep: 0.04 },
            onSuccess: { progress: +6, stress: -2, rep: +1 },
            onFail: { progress: -2, stress: +4, rep: -2 },
            note: "–û–∫–Ω–æ –º–∞–ª–µ–Ω—å–∫–æ–µ, —Ä–µ—à–µ–Ω–∏—è ‚Äî –∂—ë—Å—Ç–∫–∏–µ."
          },
          {
            title: "–û—Å—Ç–∞–≤–∏—Ç—å —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é –∫–∞–∫ –µ—Å—Ç—å",
            desc: "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–∏—à–Ω–µ–≥–æ —à—É–º–∞.",
            delta: { stress: -2, progress: +2, rep: +1 },
            note: "–ò–Ω–æ–≥–¥–∞ –ª—É—á—à–µ –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å –æ—Ä–±–∏—Ç—É."
          },
          {
            title: "–°–¥–µ–ª–∞—Ç—å —Ç–∏—Ö—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–∞–Ω–¥—ã",
            desc: "–ë–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: —É–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.",
            delta: { stress: +1, progress: +4, rep: +1 },
            note: "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ ‚Äî –Ω–µ–≤–∏–¥–∏–º–∞—è —Å–∏–ª–∞."
          }
        ]
      },

      {
        id: "debrief",
        cyclePhase: "üèÅ –ò—Ç–æ–≥–∏",
        title: "–†–∞–∑–±–æ—Ä –ø–æ–ª—ë—Ç–æ–≤ –∏ –Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ —ç–∫–∏–ø–∞–∂–µ–π",
        hint: "–£—Å–ø–µ—Ö–∏ —á–µ—Å—Ç–≤—É—é—Ç, –∞–≤–∞—Ä–∏–∏ —Ä–∞–∑–±–∏—Ä–∞—é—Ç",
        text:
`–í –Ω–∞—á–∞–ª–µ —Ü–∏–∫–ª–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç –†–∞–∑–±–æ—Ä –ü–æ–ª—ë—Ç–æ–≤:
—É—Å–ø–µ—à–Ω—ã–µ –º–∏—Å—Å–∏–∏ —á–µ—Å—Ç–≤—É—é—Ç, –∞–≤–∞—Ä–∏–∏ –æ–±—Å—É–∂–¥–∞—é—Ç, –∏–Ω–æ–≥–¥–∞ –≤—ã–ø–∏—Å—ã–≤–∞—é—Ç ¬´–∫–æ—Å–º–∏—á–µ—Å–∫–∏–µ –≤—ã–≥–æ–≤–æ—Ä—ã¬ª.

–ö–∞–∫ –≤—ã –ø—Ä–µ–∑–µ–Ω—Ç—É–µ—Ç–µ –∏—Ç–æ–≥–∏?`,
        choices: [
          {
            title: "–ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ —É—Ä–æ–∫–∏ (—á–µ—Å—Ç–Ω–æ)",
            desc: "–î–∞–∂–µ –µ—Å–ª–∏ –±—ã–ª–æ –±–æ–ª—å–Ω–æ ‚Äî –≤—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ, —á—Ç–æ —É—á–∏—Ç–µ—Å—å.",
            delta: { stress: -6, rep: +2 },
            check: { base: 0.70, rep: 0.05 },
            onSuccess: { progress: +12, stress: -4, rep: +2 },
            onFail: { progress: +6, stress: +2, rep: -1 },
            note: "–ß–µ—Å—Ç–Ω–æ—Å—Ç—å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ–≤–µ—Ä–∏–µ, –µ—Å–ª–∏ –æ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∞."
          },
          {
            title: "–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ–±–µ–¥—ã",
            desc: "–ö–æ—Ä–æ—Ç–∫–∏–π –≤—Å–ø–ª–µ—Å–∫ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏, –Ω–æ —Ä–∏—Å–∫ –æ—Ç–∫–∞—Ç–∞ –ø–æ–∑–∂–µ.",
            delta: { stress: -2, rep: +1 },
            check: { base: 0.60, rep: 0.04 },
            onSuccess: { progress: +10, stress: -2, rep: +1 },
            onFail: { progress: +3, stress: +7, rep: -2 },
            note: "–°–æ–≤–µ—Ç –ª—é–±–∏—Ç –ø–æ–±–µ–¥—ã. –ù–æ –æ–Ω –Ω–µ –ª—é–±–∏—Ç —Å—é—Ä–ø—Ä–∏–∑—ã."
          },
          {
            title: "–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å—Ç—Ä–µ–ª–∫–∏ –Ω–∞ –∞—Å—Ç–µ—Ä–æ–∏–¥—ã –∏ –∑–∞–≥—Ä—É–∑–∫—É —Ñ–ª–æ—Ç–∞",
            desc: "–û–ø—Ä–∞–≤–¥–∞–Ω–∏—è —Å–Ω–∏–∂–∞—é—Ç –¥–æ–≤–µ—Ä–∏–µ, –Ω–æ –∏–Ω–æ–≥–¥–∞ —Å–ø–∞—Å–∞—é—Ç –Ω–µ—Ä–≤—ã.",
            delta: { stress: -3, rep: -2 },
            check: { base: 0.55, rep: 0.03 },
            onSuccess: { progress: +7, stress: -4, rep: 0 },
            onFail: { progress: +1, stress: +6, rep: -3 },
            note: "–ö–æ—Å–º–æ—Å –∂–µ—Å—Ç–æ–∫, –Ω–æ –ª–∏–¥–µ—Ä—Å—Ç–≤–æ ‚Äî –ø—Ä–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å."
          }
        ]
      },

      {
        id: "new_cycle",
        cyclePhase: "üîÅ –¶–∏–∫–ª",
        title: "–ù–æ–≤—ã–π –≤–∏—Ç–æ–∫ –≥–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ü–∏–∫–ª–∞",
        hint: "–ß–µ—Ä–µ–∑ –¥–≤–µ –Ω–µ–¥–µ–ª–∏ –≤—Å—ë –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è",
        text:
`–ß–µ—Ä–µ–∑ –¥–≤–µ –Ω–µ–¥–µ–ª–∏ –≤—Å—ë –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è.
–ö–∞–ø–∏—Ç–∞–Ω—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –±–æ—Ä—å–±—É –∑–∞ —Ä–µ—Å—É—Ä—Å—ã –§–ª–æ—Ç–∞ –∏ –≤–Ω–∏–º–∞–Ω–∏–µ –°–æ–≤–µ—Ç–∞.

–í—ã –≥–æ—Ç–æ–≤–∏—Ç–µ—Å—å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ü–∏–∫–ª—É. –ß—Ç–æ –≤—ã –¥–µ–ª–∞–µ—Ç–µ?`,
        choices: [
          {
            title: "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Å–∏–≥–Ω–∞–ª –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞—Ä–∞–Ω–µ–µ",
            desc: "–°–Ω—è—Ç—å —á–∞—Å—Ç—å —Ö–∞–æ—Å–∞ —Å –±—É–¥—É—â–µ–≥–æ –°–æ–≤–µ—Ç–∞.",
            delta: { progress: +4, stress: +1, rep: +2, nextCycle: true },
            note: "–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –∞–Ω—Ç–∏–¥–æ—Ç –æ—Ç –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤."
          },
          {
            title: "–í–∑—è—Ç—å –ø–∞—É–∑—É –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç–∫–∏–ø–∞–∂",
            desc: "–°–Ω–∏–∑–∏—Ç—å —Å—Ç—Ä–µ—Å—Å –∏ –Ω–µ —Å–ª–æ–º–∞—Ç—å—Å—è –Ω–∞ –¥–ª–∏–Ω–Ω–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏.",
            delta: { progress: +1, stress: -10, rep: +0, nextCycle: true },
            note: "–ö–∞–ø–∏—Ç–∞–Ω –∂–∏–≤ ‚Äî –º–∏—Å—Å–∏–∏ –±—É–¥—É—Ç."
          },
          {
            title: "–°–æ–±—Ä–∞—Ç—å —Ä–µ—Ç—Ä–æ –∏ —É–±—Ä–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ scope creep",
            desc: "–ß—ë—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã —Å–ø–∞—Å–∞—é—Ç —Ç–æ–ø–ª–∏–≤–æ.",
            delta: { progress: +3, stress: -4, rep: +1, nextCycle: true },
            note: "–ì—Ä–∞–Ω–∏—Ü—ã ‚Äî —ç—Ç–æ —Å–∫–æ—Ä–æ—Å—Ç—å –≤ –º–∞—Å–∫–∏—Ä–æ–≤–∫–µ."
          }
        ]
      }
    ];

    /**********************
     *  STATE
     **********************/
    const DEFAULT_STATE = () => ({
      progress: 0,
      stress: 12,      // start with some tension
      rep: 0,          // hidden reputation
      cycle: 1,
      nodeIndex: 0,
      fleetLoadIndex: 1, // "–°—Ä–µ–¥–Ω—è—è"
      flags: {},
      log: [],
      ended: false,
      seed: Math.floor(Math.random() * 1e9),
      pendingToast: null,
    });

    let state = DEFAULT_STATE();

    /**********************
     *  UTILITIES
     **********************/
    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
    function fmtSigned(n){ return (n>0?`+${n}`:`${n}`); }
    function fleetLoad(){
      return FLEET_LOADS[clamp(state.fleetLoadIndex,0,FLEET_LOADS.length-1)];
    }
    function nowStamp(){
      const d = new Date();
      const hh = String(d.getHours()).padStart(2,'0');
      const mm = String(d.getMinutes()).padStart(2,'0');
      const ss = String(d.getSeconds()).padStart(2,'0');
      return `${hh}:${mm}:${ss}`;
    }

    // A deterministic-ish random (so save/load replays similar), but not cryptographically secure.
    function mulberry32(a){
      return function() {
        let t = a += 0x6D2B79F5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      }
    }
    function rng(){
      state.seed = (state.seed + 0x9E3779B9) >>> 0;
      return mulberry32(state.seed)();
    }

    function showToast(msg){
      const t = document.getElementById('toast');
      const m = document.getElementById('toastMsg');
      m.textContent = msg;
      t.classList.add('show');
      clearTimeout(showToast._timer);
      showToast._timer = setTimeout(()=> t.classList.remove('show'), 5200);
    }

    function addLog(title, text){
      state.log.unshift({
        title,
        time: nowStamp(),
        text
      });
      renderLog();
    }

    function applyDelta(delta){
      if(!delta) return;
      if(typeof delta.progress === "number") state.progress += delta.progress;
      if(typeof delta.stress === "number") state.stress += delta.stress;
      if(typeof delta.rep === "number") state.rep += delta.rep;

      if(typeof delta.fleetLoadStep === "number"){
        state.fleetLoadIndex = clamp(state.fleetLoadIndex + delta.fleetLoadStep, 0, FLEET_LOADS.length-1);
      }
      if(delta.setFlag){
        state.flags[delta.setFlag] = true;
      }
      if(delta.nextCycle){
        // handled outside (advance cycle)
      }

      // clamp core stats
      state.progress = clamp(state.progress, 0, 100);
      state.stress = clamp(state.stress, 0, 100);
    }

    function rollCheck(check){
      // success probability = base + rep*repCoef, then scaled by fleetLoad modifier and stress penalty.
      // stress penalty: high stress reduces success slightly.
      const repCoef = check?.rep ?? 0;
      const base = check?.base ?? 0.6;

      const stressPenalty = (state.stress / 100) * 0.12; // up to -12%
      const pRaw = base + state.rep * repCoef;
      const p = clamp(pRaw * fleetLoad().mod - stressPenalty, 0.06, 0.94);

      const r = rng();
      return { success: r < p, p, r };
    }

    function maybeTriggerAsteroid(){
      // Between nodes, chance depends on fleet load and stress.
      // Not every time; avoid spamming: only once per 2 nodes on average.
      const loadFactor = (state.fleetLoadIndex / (FLEET_LOADS.length-1)); // 0..1
      const stressFactor = state.stress / 100;
      const base = 0.10;
      const chance = clamp(base + loadFactor*0.12 + stressFactor*0.10, 0.08, 0.32);

      const r = rng();
      if(r < chance){
        const ev = ASTEROID_EVENTS[Math.floor(rng() * ASTEROID_EVENTS.length)];
        return ev;
      }
      return null;
    }

    function currentNode(){
      // find next node that passes gate
      for(let i = state.nodeIndex; i < NODES.length; i++){
        const node = NODES[i];
        if(typeof node.gate === "function" && !node.gate(state)) continue;
        state.nodeIndex = i;
        return node;
      }
      return null;
    }

    function renderHUD(){
      document.getElementById('valProgress').textContent = `${Math.round(state.progress)}%`;
      document.getElementById('valStress').textContent = `${Math.round(state.stress)}%`;
      document.getElementById('valCycle').textContent = `${state.cycle}`;
      document.getElementById('valFleetLoad').textContent = fleetLoad().name;

      document.getElementById('barProgress').style.width = `${state.progress}%`;
      document.getElementById('barStress').style.width = `${state.stress}%`;

      // move ship along route (from 10% to 92%)
      const x = 10 + (82 * (state.progress/100));
      document.getElementById('ship').style.left = `${x}%`;

      // slight danger flash on high stress
      const canvas = document.getElementById('galaxyCanvas');
      if(state.stress >= 85){
        canvas.classList.add('flashDanger');
        setTimeout(()=>canvas.classList.remove('flashDanger'), 380);
      }
    }

    function renderLog(){
      const el = document.getElementById('log');
      el.innerHTML = "";
      if(state.log.length === 0){
        const empty = document.createElement('div');
        empty.className = "entry";
        empty.innerHTML = `
          <div class="entryHeader"><b>–ü—É—Å—Ç–æ</b><span>${nowStamp()}</span></div>
          <p>–ñ—É—Ä–Ω–∞–ª –Ω–∞—á–Ω—ë—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.</p>
        `;
        el.appendChild(empty);
        return;
      }
      for(const it of state.log){
        const d = document.createElement('div');
        d.className = "entry";
        d.innerHTML = `
          <div class="entryHeader"><b>${escapeHtml(it.title)}</b><span>${escapeHtml(it.time)}</span></div>
          <p>${escapeHtml(it.text)}</p>
        `;
        el.appendChild(d);
      }
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function renderScene(scene, overrideTitle){
      const title = document.getElementById('sceneTitle');
      const hint = document.getElementById('sceneHint');
      const text = document.getElementById('sceneText');
      const choices = document.getElementById('choices');
      const ending = document.getElementById('ending');

      ending.style.display = "none";
      ending.innerHTML = "";

      title.textContent = overrideTitle || scene.title;
      hint.textContent = scene.hint || "‚Äî";

      document.getElementById('sceneCyclePill').textContent = `–¶–∏–∫–ª ${state.cycle}`;
      document.getElementById('sceneNodePill').textContent = `–£–∑–µ–ª: ${scene.cyclePhase}`;

      const riskPill = document.getElementById('sceneRiskPill');
      if(scene.risk){
        riskPill.style.display = "";
        riskPill.textContent = `–†–∏—Å–∫: ${scene.risk}`;
      } else {
        riskPill.style.display = "none";
      }

      text.textContent = scene.text;

      choices.innerHTML = "";
      if(scene.choices && scene.choices.length){
        for(const c of scene.choices){
          const btn = document.createElement('button');
          btn.className = "choice";
          btn.type = "button";
          btn.addEventListener('click', ()=> onChoose(scene, c));
          btn.innerHTML = renderChoiceHtml(c);
          choices.appendChild(btn);
        }
      }
      // enable/disable "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
      document.getElementById('btnNext').disabled = !!(scene.choices && scene.choices.length);
    }

    function renderChoiceHtml(c){
      const tags = [];
      if(c.delta){
        if(typeof c.delta.progress === "number" && c.delta.progress !== 0){
          tags.push({ cls: c.delta.progress>0 ? "ok":"bad", txt: `üöÄ ${fmtSigned(c.delta.progress)}%`});
        }
        if(typeof c.delta.stress === "number" && c.delta.stress !== 0){
          tags.push({ cls: c.delta.stress<0 ? "ok":"bad", txt: `üß† ${fmtSigned(c.delta.stress)}%`});
        }
        if(typeof c.delta.rep === "number" && c.delta.rep !== 0){
          tags.push({ cls: c.delta.rep>0 ? "ok":"bad", txt: `üèõ ${fmtSigned(c.delta.rep)} rep`});
        }
        if(typeof c.delta.fleetLoadStep === "number" && c.delta.fleetLoadStep !== 0){
          tags.push({ cls: "neu", txt: `üõ∞ ${c.delta.fleetLoadStep>0?"+":"-"}–Ω–∞–≥—Ä—É–∑–∫–∞`});
        }
      }
      if(c.check){
        tags.push({ cls: "neu", txt: "üé≤ –ø—Ä–æ–≤–µ—Ä–∫–∞" });
      }

      const tagsHtml = tags.map(t=>`<span class="tag ${t.cls}">${escapeHtml(t.txt)}</span>`).join("");

      return `
        <div class="choiceTop">
          <div style="flex:1">
            <p class="choiceTitle">${escapeHtml(c.title)}</p>
            <p class="choiceDesc">${escapeHtml(c.desc || "")}</p>
          </div>
          <div class="delta">${tagsHtml}</div>
        </div>
      `;
    }

    function checkEnd(){
      if(state.ended) return true;

      if(state.stress >= 100){
        state.ended = true;
        renderEnding({
          title: "–ö–†–ò–û–°–û–ù: –∫–∞–ø–∏—Ç–∞–Ω –ø–µ—Ä–µ–≥—Ä–µ–ª—Å—è",
          text:
`–°—Ç—Ä–µ—Å—Å –¥–æ—Å—Ç–∏–≥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–º–µ—Ç–∫–∏.
–ö–∞–ø–∏—Ç–∞–Ω —É—à—ë–ª –≤ –∫—Ä–∏–æ—Å–æ–Ω, –∞ –º–∏—Å—Å–∏–∏ –æ—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.

–°–æ–≤–µ—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç: ¬´–°–∏—Å—Ç–µ–º—ã –Ω–µ –≤—ã–¥–µ—Ä–∂–∞–ª–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É¬ª.`,
          kind: "fail"
        });
        return true;
      }
      if(state.progress >= 100){
        state.ended = true;
        renderEnding({
          title: "–¶–ï–ù–¢–† –ì–ê–õ–ê–ö–¢–ò–ö–ò –î–û–°–¢–ò–ì–ù–£–¢",
          text:
`–ö–æ—Ä–∞–±–ª—å –≤—Ö–æ–¥–∏—Ç –≤ —Å–∏—è–Ω–∏–µ –¶–µ–Ω—Ç—Ä–∞ –ì–∞–ª–∞–∫—Ç–∏–∫–∏.
–¶–µ–Ω–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞. –≠–∫–∏–ø–∞–∂–∏ —á–µ—Å—Ç–≤—É—é—Ç—Å—è. –°–æ–≤–µ—Ç –∞–ø–ª–æ–¥–∏—Ä—É–µ—Ç.

–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ‚Äî –∏ –æ—Å—Ç–∞–ª–∏—Å—å –≤ —Å—Ç—Ä–æ—é.`,
          kind: "win"
        });
        return true;
      }
      return false;
    }

    function renderEnding({title, text, kind}){
      const choices = document.getElementById('choices');
      choices.innerHTML = "";

      const ending = document.getElementById('ending');
      ending.style.display = "";
      ending.innerHTML = `
        <h2>${escapeHtml(title)}</h2>
        <p>${escapeHtml(text)}</p>
        <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
          <button class="btn" id="btnRestartInline">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
          <button class="btn secondary" id="btnExportInline">–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–∞</button>
        </div>
      `;
      document.getElementById('btnRestartInline').addEventListener('click', resetGame);
      document.getElementById('btnExportInline').addEventListener('click', exportLog);

      // show toast summary
      const summary =
        `–ò—Ç–æ–≥: ${kind==="win"?"–ø–æ–±–µ–¥–∞":"–ø–æ—Ä–∞–∂–µ–Ω–∏–µ"}\n`+
        `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${Math.round(state.progress)}% ‚Ä¢ –°—Ç—Ä–µ—Å—Å: ${Math.round(state.stress)}% ‚Ä¢ –¶–∏–∫–ª–æ–≤: ${state.cycle}`;
      showToast(summary);

      document.getElementById('btnNext').disabled = true;
    }

    function onChoose(scene, choice){
      if(state.ended) return;

      // Apply immediate delta
      applyDelta(choice.delta);

      // roll check if exists
      let outcomeText = "";
      if(choice.check){
        const { success, p } = rollCheck(choice.check);
        if(success){
          applyDelta(choice.onSuccess);
          outcomeText += `üé≤ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞ (—à–∞–Ω—Å ${Math.round(p*100)}%).\n`;
          outcomeText += choice.onSuccessText || "–°–æ–≤–µ—Ç –æ–¥–æ–±—Ä—è–µ—Ç –º–∞–Ω—ë–≤—Ä.";
        } else {
          applyDelta(choice.onFail);
          outcomeText += `üé≤ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≤–∞–ª–µ–Ω–∞ (—à–∞–Ω—Å ${Math.round(p*100)}%).\n`;
          outcomeText += choice.onFailText || "–°–æ–≤–µ—Ç —Ö–º—É—Ä–∏—Ç—Å—è. –¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –¥—Ä–æ–∂–∏—Ç.";
        }
      }

      // Log the choice
      const deltaSummary = summarizeDelta(choice.delta);
      const repHidden = (choice.delta?.rep || 0) !== 0 ? "\n(–†–µ–ø—É—Ç–∞—Ü–∏—è –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.)" : "";
      addLog(
        `${scene.cyclePhase}: ${scene.title}`,
        `–í—ã–±–æ—Ä: ${choice.title}\n` +
        (deltaSummary ? `${deltaSummary}\n` : "") +
        (choice.note ? `${choice.note}\n` : "") +
        (outcomeText ? `\n${outcomeText}\n` : "") +
        repHidden
      );

      renderHUD();

      // End check
      if(checkEnd()) return;

      // Advance to next node
      advanceFlow(choice.delta?.nextCycle === true);
    }

    function summarizeDelta(delta){
      if(!delta) return "";
      const parts = [];
      if(typeof delta.progress === "number" && delta.progress !== 0) parts.push(`üöÄ –ü—Ä–æ–≥—Ä–µ—Å—Å ${fmtSigned(delta.progress)}%`);
      if(typeof delta.stress === "number" && delta.stress !== 0) parts.push(`üß† –°—Ç—Ä–µ—Å—Å ${fmtSigned(delta.stress)}%`);
      if(typeof delta.fleetLoadStep === "number" && delta.fleetLoadStep !== 0) parts.push(`üõ∞ –ù–∞–≥—Ä—É–∑–∫–∞ —Ñ–ª–æ—Ç–∞ ${delta.fleetLoadStep>0?"+":"-"}—à–∞–≥`);
      // rep is hidden from player; still show subtle
      if(typeof delta.rep === "number" && delta.rep !== 0) parts.push(`üèõ –†–µ–ø—É—Ç–∞—Ü–∏—è ${fmtSigned(delta.rep)}`);
      if(delta.setFlag) parts.push(`‚öë –§–ª–∞–≥: ${delta.setFlag}`);
      return parts.length ? `–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è: ${parts.join(" ‚Ä¢ ")}` : "";
    }

    function advanceFlow(nextCycle){
      // After a decision, we may insert an asteroid event
      if(nextCycle){
        state.cycle += 1;
        // fleet load drifts each cycle a bit
        const drift = (rng() < 0.5 ? -1 : +1) * (rng() < 0.45 ? 1 : 0);
        state.fleetLoadIndex = clamp(state.fleetLoadIndex + drift, 0, FLEET_LOADS.length-1);
        addLog("üîÅ –°–∏—Å—Ç–µ–º–∞ —Ü–∏–∫–ª–æ–≤", `–ù–∞—á–∞–ª—Å—è –Ω–æ–≤—ã–π —Ü–∏–∫–ª: ${state.cycle}\n–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å —Ñ–ª–æ—Ç–∞ —Ç–µ–ø–µ—Ä—å: ${fleetLoad().name}`);
      }

      // Move node index forward
      state.nodeIndex += 1;

      // Possibly trigger asteroid disruption (between nodes), but not right after end.
      const ev = maybeTriggerAsteroid();
      if(ev){
        // Render asteroid as a temporary scene without advancing node index further.
        renderHUD();
        renderScene(ev, ev.title);
        addLog(ev.title, ev.text);
        showToast("‚òÑ –í–ù–ï–®–ù–ï–ï –°–û–ë–´–¢–ò–ï: –∞—Å—Ç–µ—Ä–æ–∏–¥–Ω–∞—è —É–≥—Ä–æ–∑–∞ –∏–∑–º–µ–Ω–∏–ª–∞ —Ü–∏–∫–ª.");
        return;
      }

      // Otherwise render next storyline node
      const node = currentNode();
      if(!node){
        // if no nodes remain, end based on progress
        state.ended = true;
        renderEnding({
          title: "–•–†–û–ù–ò–ö–ò –§–õ–û–¢–ê –ó–ê–ö–û–ù–ß–ò–õ–ò–°–¨",
          text:
`–°—é–∂–µ—Ç–Ω—ã–π –∂—É—Ä–Ω–∞–ª —ç—Ç–æ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞ –∑–∞–≤–µ—Ä—à—ë–Ω.
–ï—Å–ª–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å < 100%, –∑–Ω–∞—á–∏—Ç –¶–µ–Ω—Ç—Ä –ì–∞–ª–∞–∫—Ç–∏–∫–∏ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç ‚Äî –Ω–æ –≤—ã –≤—Å—ë –µ—â—ë –≤ —Å—Ç—Ä–æ—é.

–•–æ—Ç–∏—Ç–µ ‚Äî –¥–æ–±–∞–≤–∏–º –±–æ–ª—å—à–µ –º–∏—Å—Å–∏–π/—Å—Ü–µ–Ω (–µ—â—ë 2‚Äì3 —Ü–∏–∫–ª–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞).`,
          kind: "neutral"
        });
        return;
      }

      renderHUD();
      renderScene(node);
      saveAuto();
    }

    function saveAuto(){
      try{
        localStorage.setItem("cbonds_space_game_autosave", JSON.stringify(state));
      } catch(e){}
    }

    function saveToLocal(){
      try{
        localStorage.setItem("cbonds_space_game_save", JSON.stringify(state));
        showToast("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä (localStorage).");
      } catch(e){
        showToast("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å. –í–æ–∑–º–æ–∂–Ω–æ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –±—Ä–∞—É–∑–µ—Ä–∞.");
      }
    }

    function loadFromLocal(key){
      try{
        const raw = localStorage.getItem(key);
        if(!raw) return null;
        const obj = JSON.parse(raw);
        // minimal validation
        if(typeof obj !== "object" || obj === null) return null;
        return obj;
      } catch(e){
        return null;
      }
    }

    function loadSave(){
      const obj = loadFromLocal("cbonds_space_game_save") || loadFromLocal("cbonds_space_game_autosave");
      if(!obj){
        showToast("–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.");
        return;
      }
      state = obj;
      state.ended = !!state.ended;

      renderHUD();
      renderLog();

      if(state.ended){
        checkEnd(); // renders ending
      } else {
        const node = currentNode();
        if(node) renderScene(node);
      }

      showToast("–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ.");
    }

    function resetGame(){
      state = DEFAULT_STATE();
      renderHUD();
      state.log = [];
      renderLog();
      const node = currentNode();
      renderScene(node);
      showToast("–ù–æ–≤–∞—è –∏–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å. –£–¥–∞—á–∏, –∫–∞–ø–∏—Ç–∞–Ω.");
      saveAuto();
    }

    function exportLog(){
      const lines = [];
      lines.push(`CBONDS: –ü–æ–ª—ë—Ç –∫ –¶–µ–Ω—Ç—Ä—É –ì–∞–ª–∞–∫—Ç–∏–∫–∏`);
      lines.push(`–î–∞—Ç–∞: ${new Date().toLocaleString()}`);
      lines.push(`–ü—Ä–æ–≥—Ä–µ—Å—Å: ${Math.round(state.progress)}%`);
      lines.push(`–°—Ç—Ä–µ—Å—Å: ${Math.round(state.stress)}%`);
      lines.push(`–¶–∏–∫–ª–æ–≤: ${state.cycle}`);
      lines.push(`–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å —Ñ–ª–æ—Ç–∞: ${fleetLoad().name}`);
      lines.push(`‚Äî`);
      for(const e of [...state.log].reverse()){
        lines.push(`[${e.time}] ${e.title}`);
        lines.push(e.text);
        lines.push(`‚Äî`);
      }
      const blob = new Blob([lines.join("\n")], {type:"text/plain;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `cbonds_space_log_${Date.now()}.txt`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 8000);
    }

    function showHelp(){
      showToast(
`–ö–∞–∫ –∏–≥—Ä–∞—Ç—å:
‚Ä¢ –í—ã–±–∏—Ä–∞–π—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã ‚Äî –æ–Ω–∏ –º–µ–Ω—è—é—Ç üöÄ –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ üß† —Å—Ç—Ä–µ—Å—Å.
‚Ä¢ ¬´–†–µ–ø—É—Ç–∞—Ü–∏—è –≤ –°–æ–≤–µ—Ç–µ¬ª —Å–∫—Ä—ã—Ç–∞, –Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ üé≤.
‚Ä¢ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å —Ñ–ª–æ—Ç–∞ üõ∞ –º–µ–Ω—è–µ—Ç—Å—è –∏ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞.
‚Ä¢ –ò–Ω–æ–≥–¥–∞ –ø—Ä–∏–ª–µ—Ç–∞—é—Ç ‚òÑ –∞—Å—Ç–µ—Ä–æ–∏–¥—ã –∏ –ª–æ–º–∞—é—Ç –ø–ª–∞–Ω—ã.

–ü–æ–±–µ–¥–∞: –ø—Ä–æ–≥—Ä–µ—Å—Å 100%.
–ü–æ—Ä–∞–∂–µ–Ω–∏–µ: —Å—Ç—Ä–µ—Å—Å 100%.`
      );
    }

    function onContinue(){
      if(state.ended) return;
      // If currently on an asteroid scene with choices rendered, button is disabled by renderScene.
      // If no choices (rare), advance.
      const node = currentNode();
      if(node){
        renderScene(node);
      } else {
        advanceFlow(false);
      }
    }

    /**********************
     *  INIT / RENDER
     **********************/
    function init(){
      // clock ticker
      setInterval(()=>{
        document.getElementById('clock').textContent =
          `–°–∏—Å—Ç–µ–º–∞: CBONDS-FLEET / –í—Ä–µ–º—è: ${new Date().toLocaleTimeString()}`;
      }, 1000);

      // bind buttons
      document.getElementById('btnHelp').addEventListener('click', showHelp);
      document.getElementById('btnSave').addEventListener('click', saveToLocal);
      document.getElementById('btnLoad').addEventListener('click', loadSave);
      document.getElementById('btnReset').addEventListener('click', resetGame);
      document.getElementById('btnExport').addEventListener('click', exportLog);
      document.getElementById('btnNext').addEventListener('click', onContinue);

      document.getElementById('toastClose').addEventListener('click', ()=>{
        document.getElementById('toast').classList.remove('show');
      });

      // try autosave
      const auto = loadFromLocal("cbonds_space_game_autosave");
      if(auto && typeof auto === "object"){
        state = auto;
        showToast("–ê–≤—Ç–æ—Å–µ–π–≤ –Ω–∞–π–¥–µ–Ω ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∏–ª–∏ –ø–æ–ª—ë—Ç.");
      } else {
        showToast("–ö–∞–Ω–∞–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ü—Ä–∏—ë–º —Å–∏–≥–Ω–∞–ª–æ–≤ –∞–∫—Ç–∏–≤–µ–Ω.");
      }

      renderHUD();
      renderLog();

      if(state.ended){
        checkEnd();
      } else {
        const node = currentNode();
        renderScene(node);
      }
    }

    init();
  </script>
</body>
</html>
